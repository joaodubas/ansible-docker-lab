# encoding: utf-8
import json
import os
import sys


def docker_env():
    """docker_env -- Load environment variables specified in a `.dockerenv`
    file. The new variables are only loaded if they aren't set already.

    """
    env_keys = os.environ.keys()
    envs = dict(v.split('=') for v in json.load(open('/.dockerenv')))
    tmpl = 'export {}={}\n'
    return (tmpl.format(k, v) for k, v in envs.iteritems() if k not in env_keys)


def load(i):
    """load -- Expose a iterable of instructions to the system output."""
    for instruction in i:
        sys.stdout.write(instruction)


if __name__ == '__main__':
    try:
        load(docker_env())
    except IOError:
        pass
